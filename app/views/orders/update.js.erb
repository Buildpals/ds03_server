const publicKey = "FLWPUBK-8289a3561ffe0c40c4904e20d550db77-X";
var txref = "Order_<%= @order.id %>_" + Math.floor(Math.pow(10, length - 1) + Math.random() * 9 * Math.pow(10, length - 1));

payWithRave()

function payWithRave() {
    var reference = txref;
    var phone = $('#phone_number').val();
    var name = $('#full_name').val();
    var email = $('#email').val();
    if (phone = "" || name == "" || email == "") {
        alert("Please fill out your name, email and phone number");
        return;
    }
    var shipping = "<%=  @order.shipping_and_handling %>";
    var price = parseInt("<%= @order.order_total %>") * 5.71;
    var quantity = "<%= @order.item_quantity %>";
    var orderId = "<%= @order.id %>";
    var x = getpaidSetup({
        PBFPubKey: publicKey,
        customer_email: email,
        amount: price,
        customer_phone: phone,
        currency: "GHS",
        country: 'GH',
        payment_options: "mobilemoneyghana,card",
        txref: txref,
        meta: [{
            order_id: "<%= @order.id %>",
            link_to_order: "<%= order_url @order %>",
            title: "<%= escape_javascript @order.title %>",
            item_url: "<%= escape_javascript @order.item_url %>",
            price: "<%= escape_javascript number_to_currency @order.price_dollars %>",
            quantity: "<%= escape_javascript @order.item_quantity %>",
            items_cost: "<%= escape_javascript number_to_currency @order.items_cost %>",
            delivery_method: "<%= escape_javascript @order.delivery_method.titleize %>",
            delivery_region: "<%= escape_javascript @order.delivery_region.titleize %>",
            shipping_and_handling: "<%= escape_javascript number_to_currency @order.shipping_and_handling %>",
            estimated_duty: "<%= escape_javascript number_to_currency @order.estimated_duty %>",
            order_total: "<%= escape_javascript number_to_currency @order.order_total %>",
            full_name: "<%= escape_javascript @order.full_name %>",
            email: "<%= escape_javascript @order.email %>",
            phone_number: "<%= escape_javascript @order.phone_number %>"
        }],
        onclose: function () {
        },
        callback: function (response) {
            var txref = response.tx.txRef; // collect txRef returned and pass to a 					server page to complete status check.
            console.log("This is the response returned after a charge", response);
            if (
                response.tx.chargeResponseCode == "00" ||
                response.tx.chargeResponseCode == "0"
            ) {
                //show success modal
                window.location.href = '/payment?' + 'txtref=' + reference + '&order_id=' + orderId + '&email=' + email + '&phone_number=' + phone + '&name=' + name + '';
            } else {
                // show failure modal
            }

            x.close();
        }
    });
}